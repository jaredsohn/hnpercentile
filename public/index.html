<!DOCTYPE html>
<html>
  <head>
    <title>Hacker News percentile</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  </head>
  <body>
    <h1>Hacker News Karma Percentile</h1>
    <form>
    Enter your Hacker News Username: <input id="username" type="text"> 
    <input type="submit" value="See your Percentile">
    </form>
    <div id="error"></div>
    <div id="result_box" style="display:none">
      <h2>Username</h2>
      As of: <span id="time"></span><br>
      Karma: <span id="karma"></span><br>
      <hr>
      <div id="overall">
        <h3>Overall</h3>
        Total users: <span class="total"></span><br>
        Total users with less karma than you: <span class="below_karma"></span><br>
        Percentile: <span class="percentile"></span>
      </div>
      <hr>
      <div id="reg_month">
        <h3>Among users in your registration month (<span class="reg_month"></span>)</h3>
        Total users: <span class="total"></span><br>
        Total users with less karma than you: <span class="below_karma"></span><br>
      Percentile: <span class="percentile"></span>
      </div>
    </div>
    <script>
      var monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];

      function to_percent(f) {
        return (f * 100).toFixed(2) + '%';
      }
      $("form").submit(function() {
        $('#result_box').hide();
        var username = $('#username').val();
        $.ajax("/user/" + username + '.json').done(function(response) {
          $('#error').text('');
          $('h2').text(username);
          var time = new Date(response['updated_at']);
          var overall = response['percentile'];
          var month = response['month_percentile'];
          var karma = response['karma'];
          var reg = new Date(response['date_registered']);
          
          $('.reg_month').text(monthNames[reg.getMonth()] + " " + reg.getFullYear());
          
          $('#overall .percentile').text(to_percent(overall['percentile']));
          $('#overall .total').text(overall['population']);
          $('#overall .below_karma').text(overall['below_karma']);
          
          $('#reg_month .percentile').text(to_percent(month['percentile']));
          $('#reg_month .total').text(month['population']);
          $('#reg_month .below_karma').text(month['below_karma']);
          
          $('#time').text(time);
          $('#karma').text(karma);
          $("#result_box").show();
        }).error(function(response) {
          $('#error').text("Invalid Username");
        });
        return false;
      });
    </script>
  </body>
</html>
