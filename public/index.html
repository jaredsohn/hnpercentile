<!DOCTYPE html>
<html>
  <head>
    <title>Hacker News percentile</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  </head>
  <body>
    Enter your Hacker News Username: <input id="username" type="text"><br>
    <button>See your Percentile</button>
    <div id="result_box" style="display:none">
      As of: <span id="time"></span><br>
      Karma: <span id="karma"></span><br>
      <hr>
      Total users on Hacker News: <span id="overall_total"></span><br>
      Total users with less karma than you: <span id="overall_below_karma"></span><br>
      Percentile against all users: <span id="overall_percentile"></span>
      <hr>
      Total users on Hacker News with same reg month: <span id="month_total"></span><br>
      Total users with less karma than you in same reg month: <span id="month_below_karma"></span><br>
      Percentile against users in your reg month: <span id="month_percentile"></span>
    </div>
    <script>
      function to_percent(f) {
        return (f * 100).toFixed(2) + '%'
      }
      $("button").click(function() {
        var username = $('#username').val();
        $.ajax("/user/" + username + '.json').done(function(response) {
          var time = new Date(response['updated_at'])
          var overall = response['percentile']
          var month = response['month_percentile']
          var karma = response['karma'];
          
          $('#overall_percentile').text(to_percent(overall['percentile']));
          $('#overall_total').text(overall['population']);
          $('#overall_below_karma').text(overall['below_karma']);
          
          $('#month_percentile').text(to_percent(month['percentile']));
          $('#month_total').text(month['population']);
          $('#month_below_karma').text(month['below_karma']);
          
          $('#time').text(time);
          $('#karma').text(karma);
          $("#result_box").show();
        });
      });
    </script>
  </body>
</html>
